# Supabase Quick Start (5 minutes)

## TL;DR - Get Events Shared in 5 Steps

### Step 1: Create Supabase Project
Go to https://supabase.com â†’ "New Project" â†’ name it "nocturne-events"

### Step 2: Get Credentials
Settings â†’ API â†’ Copy:
- **Project URL** â†’ `SUPABASE_URL`
- **anon public key** â†’ `SUPABASE_KEY`

### Step 3: Add to `.env`
```
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_KEY=eyJhbGc...your-key...
```

### Step 4: Create Tables
Go to SQL Editor in Supabase, paste this, click "Run":

```sql
CREATE TABLE events (
    id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    title TEXT NOT NULL,
    link TEXT UNIQUE NOT NULL,
    date DATE NOT NULL,
    time TEXT,
    location TEXT,
    description TEXT,
    source TEXT,
    city TEXT NOT NULL,
    synced_at TIMESTAMP DEFAULT now(),
    last_scraped TIMESTAMP DEFAULT now(),
    created_at TIMESTAMP DEFAULT now()
);

CREATE INDEX idx_events_city ON events(city);
CREATE INDEX idx_events_city_date ON events(city, date);

CREATE TABLE subscriptions (
    id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    email TEXT NOT NULL,
    city TEXT NOT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT now(),
    unsubscribed_at TIMESTAMP,
    UNIQUE(email, city)
);

CREATE INDEX idx_subscriptions_city ON subscriptions(city, is_active);
```

### Step 5: Enable Row Level Security (RLS)
1. Go to "Authentication" â†’ "Policies"
2. For `events`: Create "Enable read access for all users"
3. For `subscriptions`: Create "Enable all access"

## Install Package
```bash
pip install supabase
```

## Test It

1. Restart backend
2. Click a city
3. Click "REFRESH EVENTS (1/1)"
4. Check Supabase â†’ Table Editor â†’ `events` table
5. See new events appear! ðŸŽ‰

## What Happens Now

```
You scrape NYC events
    â†“
Events saved locally
    â†“
Events synced to Supabase
    â†“
Your friend views NYC
    â†“
Sees your scraped events (shared!)
```

## Verify It's Working

Check backend logs:
```bash
tail -f logs/app.log | grep -i supabase
```

Should show:
```
INFO: Supabase client initialized successfully
INFO: Supabase sync result: {'status': 'success', 'synced': 42, 'updated': 15}
```

## If It Doesn't Work

### Missing "Supabase not configured" warning
- Check `.env` has `SUPABASE_URL` and `SUPABASE_KEY`
- Restart backend

### Events not appearing in Supabase
- Check tables were created correctly
- Verify RLS policies are enabled
- Check logs for errors

### "Supabase not installed"
```bash
pip install supabase
```

## That's It! ðŸš€

Events now sync automatically. Users can:
1. Click any city
2. Click "REFRESH EVENTS"
3. See new events appear live (from their own or others' scrapes)
4. All events are shared across all users

## Next Steps

- Read `SUPABASE_SETUP.md` for detailed setup
- Read `SUPABASE_EVENTS_INTEGRATION.md` for architecture
- Check Supabase docs: https://supabase.com/docs

---

**Need help?** See full docs in SUPABASE_SETUP.md
